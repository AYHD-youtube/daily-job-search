{% extends "base.html" %}

{% block title %}Dashboard - Daily Job Search{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="fw-bold text-primary mb-1">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </h2>
                <p class="text-muted">Welcome back, {{ current_user.name }}!</p>
            </div>
            <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#newSearchModal">
                <i class="fas fa-plus"></i> New Search Configuration
            </button>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="stat-card bg-primary text-white">
            <div class="stat-icon">
                <i class="fas fa-briefcase"></i>
            </div>
            <div class="stat-content">
                <h3 class="mb-0">{{ total_jobs }}</h3>
                <p class="mb-0">Total Jobs Found</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="stat-card bg-success text-white">
            <div class="stat-icon">
                <i class="fas fa-search"></i>
            </div>
            <div class="stat-content">
                <h3 class="mb-0">{{ active_configs }}</h3>
                <p class="mb-0">Active Searches</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="stat-card bg-info text-white">
            <div class="stat-icon">
                <i class="fas fa-envelope"></i>
            </div>
            <div class="stat-content">
                <h3 class="mb-0">
                    {% if current_user.google_credentials %}
                        <i class="fas fa-check"></i>
                    {% else %}
                        <i class="fas fa-times"></i>
                    {% endif %}
                </h3>
                <p class="mb-0">Email Configured</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Recent Job Results -->
    <div class="col-lg-8 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-briefcase"></i> Recent Job Results
                    </h5>
                    <a href="/jobs" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i> View All Jobs
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if recent_jobs %}
                    <div class="list-group">
                        {% for job in recent_jobs %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">
                                    <a href="{{ job.link }}" target="_blank" class="text-decoration-none">
                                        {{ job.title }}
                                    </a>
                                </h6>
                                <small class="text-muted">{{ job.found_at.strftime('%m/%d %H:%M') }}</small>
                            </div>
                            <p class="mb-1">
                                <span class="badge bg-secondary">{{ job.job_site }}</span>
                                <span class="badge bg-primary">{{ job.keyword }}</span>
                            </p>
                            <p class="mb-1 text-muted">{{ job.snippet[:150] }}{% if job.snippet|length > 150 %}...{% endif %}</p>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No job results yet. Create a search configuration to get started!</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Search Configurations -->
    <div class="col-lg-4 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="fas fa-cog"></i> Search Configurations
                </h5>
            </div>
            <div class="card-body">
                <div id="searchConfigsContainer">
                    <div class="text-center py-3">
                        <i class="fas fa-plus-circle fa-2x text-muted mb-2"></i>
                        <p class="text-muted mb-0">No search configurations yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Search Configuration Modal -->
<div class="modal fade" id="newSearchModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">New Search Configuration</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="searchConfigForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="configName" class="form-label">Configuration Name</label>
                                <input type="text" class="form-control" id="configName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="searchTime" class="form-label">Email Time</label>
                                <input type="time" class="form-control" id="searchTime" value="09:00">
                                <div class="form-text">When to send job search emails</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="frequency" class="form-label">Email Frequency</label>
                        <select class="form-select" id="frequency" required>
                            <option value="daily">Daily - Every day</option>
                            <option value="hourly">Hourly - Every hour</option>
                            <option value="2hourly">2-Hourly - Every 2 hours</option>
                            <option value="3hourly">3-Hourly - Every 3 hours</option>
                            <option value="weekdays">Weekdays - Monday to Friday</option>
                            <option value="weekly">Weekly - Once per week</option>
                            <option value="twice_weekly">Twice Weekly - Monday & Thursday</option>
                            <option value="custom">Custom - Define your own schedule</option>
                        </select>
                        <div class="form-text">
                            How often you want to receive job search emails<br>
                            <small class="text-muted">
                                <strong>Hourly:</strong> Every hour at the specified minute<br>
                                <strong>2-Hourly:</strong> Every 2 hours starting from specified time<br>
                                <strong>3-Hourly:</strong> Every 3 hours starting from specified time
                            </small>
                        </div>
                    </div>
                    
                    <div class="mb-3" id="customFrequencyContainer" style="display: none;">
                        <label for="customFrequency" class="form-label">Custom Frequency</label>
                        <div class="row">
                            <div class="col-6">
                                <label for="frequencyDays" class="form-label">Days of Week</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="mon" value="monday">
                                    <label class="form-check-label" for="mon">Monday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="tue" value="tuesday">
                                    <label class="form-check-label" for="tue">Tuesday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="wed" value="wednesday">
                                    <label class="form-check-label" for="wed">Wednesday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="thu" value="thursday">
                                    <label class="form-check-label" for="thu">Thursday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="fri" value="friday">
                                    <label class="form-check-label" for="fri">Friday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="sat" value="saturday">
                                    <label class="form-check-label" for="sat">Saturday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="sun" value="sunday">
                                    <label class="form-check-label" for="sun">Sunday</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <label for="frequencyInterval" class="form-label">Interval (weeks)</label>
                                <select class="form-select" id="frequencyInterval">
                                    <option value="1">Every week</option>
                                    <option value="2">Every 2 weeks</option>
                                    <option value="3">Every 3 weeks</option>
                                    <option value="4">Every 4 weeks</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-text">Select specific days and interval for custom frequency</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="keywords" class="form-label">Keywords (comma-separated)</label>
                        <input type="text" class="form-control" id="keywords" placeholder="Business, Marketing, Software Engineer" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="searchLogic" class="form-label">Search Logic</label>
                        <select class="form-select" id="searchLogic">
                            <option value="AND">All Keywords (AND) - Jobs must contain all keywords</option>
                            <option value="OR">Any Keyword (OR) - Jobs matching any keyword</option>
                            <option value="CUSTOM">Custom Logic - Define your own search pattern</option>
                        </select>
                        <div class="form-text">Choose how keywords should be combined in the search</div>
                    </div>
                    
                    <div class="mb-3" id="customLogicContainer" style="display: none;">
                        <label for="customLogic" class="form-label">Custom Search Logic</label>
                        <input type="text" class="form-control" id="customLogic" placeholder="(Python AND Django) OR (React AND Node.js)">
                        <div class="form-text">
                            Use AND, OR, parentheses. Example: <code>(Python AND Django) OR (React AND Node.js)</code>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="locationFilter" class="form-label">Location Filter</label>
                        <input type="text" class="form-control" id="locationFilter" value='remote OR "United States"'>
                    </div>
                    
                    <div class="mb-3">
                        <label for="maxJobAge" class="form-label">Maximum Job Age</label>
                        <select class="form-select" id="maxJobAge">
                            <option value="1">Last 1 hour</option>
                            <option value="3">Last 3 hours</option>
                            <option value="6">Last 6 hours</option>
                            <option value="12">Last 12 hours</option>
                            <option value="24" selected>Last 24 hours</option>
                            <option value="48">Last 48 hours</option>
                            <option value="72">Last 3 days</option>
                            <option value="168">Last week</option>
                            <option value="0">No age limit</option>
                        </select>
                        <div class="form-text">Only show jobs posted within this time frame</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Job Sites</label>
                        <div class="row" id="jobSitesContainer">
                            <!-- Job sites will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="isActive" checked>
                        <label class="form-check-label" for="isActive">
                            Active (start searching at scheduled time)
                        </label>
                    </div>
                    
                    <div class="d-flex justify-content-end gap-2 mt-4">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Configuration</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Test Search Modal -->
<div class="modal fade" id="testSearchModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Test Search</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="testResults">
                    <div class="text-center">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Searching...</span>
                        </div>
                        <p class="mt-2">Searching for jobs...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const jobSites = [
    "myworkdayjobs.com", "greenhouse.io", "icims.com", "taleo.net", "lever.co",
    "smartrecruiters.com", "jobvite.com", "workforcenow.adp.com", "successfactors.com",
    "brassring.com", "jazzhr.com", "breezy.hr", "jobdiva.com", "bullhorn.com", "bamboohr.com"
];

// Initialize job sites checkboxes
function initJobSites() {
    const container = document.getElementById('jobSitesContainer');
    jobSites.forEach((site, index) => {
        const col = document.createElement('div');
        col.className = 'col-md-4 mb-2';
        col.innerHTML = `
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="site_${index}" value="${site}" checked>
                <label class="form-check-label" for="site_${index}">${site}</label>
            </div>
        `;
        container.appendChild(col);
    });
}

// This function has been moved to static/js/app.js

// This function has been moved to static/js/app.js as editSearchConfig

// This function has been moved to static/js/app.js as deleteSearchConfig

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    initJobSites();
});
</script>
{% endblock %}